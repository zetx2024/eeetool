<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEEE Advanced Citation Generator | Youth Research Journal</title>
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --secondary-color: #f5f5f5;
            --text-color: #333;
            --light-text: #f5f5f5;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }

        .form-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .result-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-height: 80vh;
            overflow-y: auto;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-dark);
        }

        input[type="text"],
        input[type="url"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border 0.3s;
        }

        input[type="text"]:focus,
        input[type="url"]:focus,
        input[type="date"]:focus,
        select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        .citation-result {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 4px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
            word-wrap: break-word;
            margin-bottom: 15px;
        }

        .copy-btn {
            background-color: var(--primary-light);
            margin-top: 5px;
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }

        .copy-btn:hover {
            background-color: var(--primary-dark);
        }

        .source-type-fields {
            display: none;
        }

        .source-type-fields.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: var(--text-color);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .authors-container {
            margin-bottom: 15px;
        }

        .author-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .author-input input {
            flex: 1;
        }

        .add-author-btn {
            background-color: var(--primary-light);
            margin-bottom: 15px;
        }

        .remove-author-btn {
            background-color: #d32f2f;
            padding: 8px 12px;
            width: auto;
        }

        .remove-author-btn:hover {
            background-color: #b71c1c;
        }

        .fetch-btn {
            background-color: var(--primary-light);
            position: absolute;
            right: 0;
            top: 30px;
            width: auto;
            padding: 8px 12px;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-message {
            margin-top: 5px;
            font-size: 0.9rem;
            min-height: 20px;
        }

        .success {
            color: var(--primary-dark);
        }

        .error {
            color: #d32f2f;
        }

        .citation-history {
            margin-top: 30px;
        }

        .citation-item {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .citation-item .copy-btn {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .delete-btn {
            background-color: #d32f2f;
            position: absolute;
            top: 15px;
            right: 90px;
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }

        .delete-btn:hover {
            background-color: #b71c1c;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .citation-item .copy-btn {
                position: static;
                display: inline-block;
                margin-right: 10px;
            }
            
            .delete-btn {
                position: static;
                display: inline-block;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>IEEE Advanced Citation Generator</h1>
            <p class="subtitle">Generate accurate IEEE citations with YRJ</p>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <section class="form-section">
                <h2>Citation Details</h2>
                <div class="form-group">
                    <label for="source-type">Source Type</label>
                    <select id="source-type">
                        <option value="website">Website</option>
                        <option value="book">Book</option>
                        <option value="journal">Journal Article</option>
                        <option value="conference">Conference Paper</option>
                        <option value="thesis">Thesis/Dissertation</option>
                        <option value="report">Technical Report</option>
                        <option value="patent">Patent</option>
                        <option value="standard">Standard</option>
                    </select>
                </div>

                <!-- Common fields for all source types -->
                <div class="form-group">
                    <label for="title">Title*</label>
                    <input type="text" id="title" placeholder="Enter title of the work" required>
                </div>

                <div class="form-group authors-container">
                    <label>Authors*</label>
                    <div id="authors-list">
                        <div class="author-input">
                            <input type="text" class="author-name" placeholder="Last name, First name" required>
                            <button type="button" class="remove-author-btn">Ã—</button>
                        </div>
                    </div>
                    <button type="button" id="add-author" class="add-author-btn">Add Another Author</button>
                </div>

                <div class="form-group">
                    <label for="year">Publication Year*</label>
                    <input type="text" id="year" placeholder="YYYY" required>
                </div>

                <!-- Website specific fields -->
                <div id="website-fields" class="source-type-fields active">
                    <div class="form-group">
                        <label for="website-name">Website Name</label>
                        <input type="text" id="website-name" placeholder="e.g., IEEE Xplore">
                    </div>
                    <div class="form-group">
                        <label for="url">URL*</label>
                        <input type="url" id="url" placeholder="https://example.com">
                        <button type="button" id="fetch-website" class="fetch-btn">Fetch Data</button>
                        <div id="website-status" class="status-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="access-date">Access Date</label>
                        <input type="date" id="access-date">
                    </div>
                </div>

                <!-- Book specific fields -->
                <div id="book-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="publisher">Publisher*</label>
                        <input type="text" id="publisher" placeholder="Publisher name">
                    </div>
                    <div class="form-group">
                        <label for="edition">Edition</label>
                        <input type="text" id="edition" placeholder="e.g., 2nd ed.">
                    </div>
                    <div class="form-group">
                        <label for="isbn">ISBN</label>
                        <input type="text" id="isbn" placeholder="ISBN number">
                        <button type="button" id="fetch-book" class="fetch-btn">Fetch Data</button>
                        <div id="book-status" class="status-message"></div>
                    </div>
                </div>

                <!-- Journal specific fields -->
                <div id="journal-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="journal-name">Journal Name*</label>
                        <input type="text" id="journal-name" placeholder="Journal name">
                    </div>
                    <div class="form-group">
                        <label for="volume">Volume</label>
                        <input type="text" id="volume" placeholder="Volume number">
                    </div>
                    <div class="form-group">
                        <label for="issue">Issue</label>
                        <input type="text" id="issue" placeholder="Issue number">
                    </div>
                    <div class="form-group">
                        <label for="page-range">Page Range*</label>
                        <input type="text" id="page-range" placeholder="e.g., 123-130">
                    </div>
                    <div class="form-group">
                        <label for="doi">DOI</label>
                        <input type="text" id="doi" placeholder="DOI number">
                        <button type="button" id="fetch-journal" class="fetch-btn">Fetch Data</button>
                        <div id="journal-status" class="status-message"></div>
                    </div>
                </div>

                <!-- Conference specific fields -->
                <div id="conference-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="conference-name">Conference Name*</label>
                        <input type="text" id="conference-name" placeholder="Conference name">
                    </div>
                    <div class="form-group">
                        <label for="conference-location">Conference Location</label>
                        <input type="text" id="conference-location" placeholder="City, Country">
                    </div>
                    <div class="form-group">
                        <label for="conference-date">Conference Date</label>
                        <input type="text" id="conference-date" placeholder="Month Day, Year">
                    </div>
                    <div class="form-group">
                        <label for="conference-page-range">Page Range</label>
                        <input type="text" id="conference-page-range" placeholder="e.g., 123-130">
                    </div>
                    <div class="form-group">
                        <label for="conference-doi">DOI</label>
                        <input type="text" id="conference-doi" placeholder="DOI number">
                        <button type="button" id="fetch-conference" class="fetch-btn">Fetch Data</button>
                        <div id="conference-status" class="status-message"></div>
                    </div>
                </div>

                <!-- Thesis specific fields -->
                <div id="thesis-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="thesis-type">Type*</label>
                        <select id="thesis-type">
                            <option value="PhD dissertation">PhD Dissertation</option>
                            <option value="Master's thesis">Master's Thesis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="institution">Institution*</label>
                        <input type="text" id="institution" placeholder="University name">
                    </div>
                    <div class="form-group">
                        <label for="thesis-location">Location</label>
                        <input type="text" id="thesis-location" placeholder="City, Country">
                    </div>
                </div>

                <!-- Report specific fields -->
                <div id="report-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="report-number">Report Number</label>
                        <input type="text" id="report-number" placeholder="Report number">
                    </div>
                    <div class="form-group">
                        <label for="report-institution">Institution*</label>
                        <input type="text" id="report-institution" placeholder="Institution name">
                    </div>
                    <div class="form-group">
                        <label for="report-location">Location</label>
                        <input type="text" id="report-location" placeholder="City, Country">
                    </div>
                </div>

                <!-- Patent specific fields -->
                <div id="patent-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="patent-number">Patent Number*</label>
                        <input type="text" id="patent-number" placeholder="e.g., US 1234567 B1">
                    </div>
                    <div class="form-group">
                        <label for="patent-date">Patent Date*</label>
                        <input type="text" id="patent-date" placeholder="Month Day, Year">
                    </div>
                    <div class="form-group">
                        <label for="assignee">Assignee</label>
                        <input type="text" id="assignee" placeholder="Assignee name">
                    </div>
                </div>

                <!-- Standard specific fields -->
                <div id="standard-fields" class="source-type-fields">
                    <div class="form-group">
                        <label for="standard-number">Standard Number*</label>
                        <input type="text" id="standard-number" placeholder="e.g., IEEE Std 802.11">
                    </div>
                    <div class="form-group">
                        <label for="standard-title">Standard Title*</label>
                        <input type="text" id="standard-title" placeholder="Standard title">
                    </div>
                    <div class="form-group">
                        <label for="standard-publisher">Publisher*</label>
                        <input type="text" id="standard-publisher" placeholder="Publisher name">
                    </div>
                    <div class="form-group">
                        <label for="standard-date">Publication Date</label>
                        <input type="text" id="standard-date" placeholder="Year">
                    </div>
                </div>

                <button type="button" id="generate-btn">Generate Citation</button>
            </section>

            <section class="result-section">
                <h2>Your IEEE Citation</h2>
                <div id="current-citation" class="citation-result">
                    <p>Your generated citation will appear here...</p>
                </div>
                <button type="button" id="copy-current-btn" class="copy-btn">Copy Citation</button>
                
                <div class="citation-history">
                    <h3>Citation History</h3>
                    <div id="citation-history">
                        <!-- Generated citations will appear here -->
                    </div>
                </div>
            </section>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>IEEE Advanced Citation Generator | For academic and research purposes</p>
            <p>Developed by <a href="https://md-sanaul-haque-shanto.github.io/">Md Sanaul Haque Shanto</a></p>
            <p>Organized by Youth Research Journal - Research Competition and Flagship Research Program for High School and University Students</p>
            <p>Note: Always verify generated citations with your institution's style guide.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Source type switcher
            const sourceTypeSelect = document.getElementById('source-type');
            const allSourceFields = document.querySelectorAll('.source-type-fields');
            
            sourceTypeSelect.addEventListener('change', function() {
                // Hide all source type fields
                allSourceFields.forEach(field => {
                    field.classList.remove('active');
                });
                
                // Show the selected source type fields
                const selectedType = this.value;
                document.getElementById(`${selectedType}-fields`).classList.add('active');
            });

            // Author management
            const authorsList = document.getElementById('authors-list');
            const addAuthorBtn = document.getElementById('add-author');
            
            addAuthorBtn.addEventListener('click', function() {
                const authorDiv = document.createElement('div');
                authorDiv.className = 'author-input';
                authorDiv.innerHTML = `
                    <input type="text" class="author-name" placeholder="Last name, First name" required>
                    <button type="button" class="remove-author-btn">Ã—</button>
                `;
                authorsList.appendChild(authorDiv);
                
                // Add event listener to the new remove button
                authorDiv.querySelector('.remove-author-btn').addEventListener('click', function() {
                    if (authorsList.children.length > 1) {
                        authorsList.removeChild(authorDiv);
                    } else {
                        alert('You need at least one author.');
                    }
                });
            });

            // Add event listener to initial remove button
            document.querySelector('.remove-author-btn').addEventListener('click', function() {
                if (authorsList.children.length > 1) {
                    authorsList.removeChild(this.parentElement);
                } else {
                    alert('You need at least one author.');
                }
            });

            // Generate citation
            const generateBtn = document.getElementById('generate-btn');
            const currentCitationResult = document.getElementById('current-citation');
            const citationHistory = document.getElementById('citation-history');
            
            generateBtn.addEventListener('click', function() {
                // Validate required fields
                if (!validateFields()) {
                    return;
                }
                
                const sourceType = sourceTypeSelect.value;
                let citation;
                
                switch (sourceType) {
                    case 'website':
                        citation = generateWebsiteCitation();
                        break;
                    case 'book':
                        citation = generateBookCitation();
                        break;
                    case 'journal':
                        citation = generateJournalCitation();
                        break;
                    case 'conference':
                        citation = generateConferenceCitation();
                        break;
                    case 'thesis':
                        citation = generateThesisCitation();
                        break;
                    case 'report':
                        citation = generateReportCitation();
                        break;
                    case 'patent':
                        citation = generatePatentCitation();
                        break;
                    case 'standard':
                        citation = generateStandardCitation();
                        break;
                    default:
                        citation = "Citation type not supported.";
                }
                
                // Display current citation
                currentCitationResult.innerHTML = `<p>${citation}</p>`;
                
                // Add to history
                addToHistory(citation);
            });

            // Copy current citation
            const copyCurrentBtn = document.getElementById('copy-current-btn');
            
            copyCurrentBtn.addEventListener('click', function() {
                const citationText = currentCitationResult.textContent;
                copyToClipboard(citationText, copyCurrentBtn);
            });

            // Function to add citation to history
            function addToHistory(citation) {
                const citationId = Date.now();
                const citationItem = document.createElement('div');
                citationItem.className = 'citation-item';
                citationItem.innerHTML = `
                    <p>${citation}</p>
                    <button type="button" class="copy-btn" data-id="${citationId}">Copy</button>
                    <button type="button" class="delete-btn" data-id="${citationId}">Delete</button>
                `;
                citationHistory.prepend(citationItem);
                
                // Add event listeners to the new buttons
                citationItem.querySelector('.copy-btn').addEventListener('click', function() {
                    const text = this.parentElement.querySelector('p').textContent;
                    copyToClipboard(text, this);
                });
                
                citationItem.querySelector('.delete-btn').addEventListener('click', function() {
                    citationItem.remove();
                });
            }

            // Function to copy text to clipboard
            function copyToClipboard(text, button) {
                navigator.clipboard.writeText(text).then(function() {
                    const originalText = button.textContent;
                    button.textContent = 'Copied!';
                    
                    setTimeout(function() {
                        button.textContent = originalText;
                    }, 2000);
                }, function(err) {
                    console.error('Could not copy text: ', err);
                });
            }

            // Field validation
            function validateFields() {
                const title = document.getElementById('title').value.trim();
                const authors = Array.from(document.querySelectorAll('.author-name')).map(a => a.value.trim()).filter(a => a);
                const year = document.getElementById('year').value.trim();
                
                if (!title) {
                    alert('Please enter the title.');
                    return false;
                }
                
                if (authors.length === 0 || authors.some(a => !a)) {
                    alert('Please enter at least one author.');
                    return false;
                }
                
                if (!year) {
                    alert('Please enter the publication year.');
                    return false;
                }
                
                // Source-specific validation
                const sourceType = sourceTypeSelect.value;
                
                if (sourceType === 'website' && !document.getElementById('url').value.trim()) {
                    alert('Please enter the URL for a website citation.');
                    return false;
                }
                
                if (sourceType === 'book' && !document.getElementById('publisher').value.trim()) {
                    alert('Please enter the publisher for a book citation.');
                    return false;
                }
                
                if (sourceType === 'journal') {
                    if (!document.getElementById('journal-name').value.trim()) {
                        alert('Please enter the journal name.');
                        return false;
                    }
                    if (!document.getElementById('page-range').value.trim()) {
                        alert('Please enter the page range.');
                        return false;
                    }
                }
                
                if (sourceType === 'conference' && !document.getElementById('conference-name').value.trim()) {
                    alert('Please enter the conference name.');
                    return false;
                }
                
                if (sourceType === 'thesis' && !document.getElementById('institution').value.trim()) {
                    alert('Please enter the institution for a thesis citation.');
                    return false;
                }
                
                if (sourceType === 'report' && !document.getElementById('report-institution').value.trim()) {
                    alert('Please enter the institution for a report citation.');
                    return false;
                }
                
                if (sourceType === 'patent') {
                    if (!document.getElementById('patent-number').value.trim()) {
                        alert('Please enter the patent number.');
                        return false;
                    }
                    if (!document.getElementById('patent-date').value.trim()) {
                        alert('Please enter the patent date.');
                        return false;
                    }
                }
                
                if (sourceType === 'standard') {
                    if (!document.getElementById('standard-number').value.trim()) {
                        alert('Please enter the standard number.');
                        return false;
                    }
                    if (!document.getElementById('standard-title').value.trim()) {
                        alert('Please enter the standard title.');
                        return false;
                    }
                    if (!document.getElementById('standard-publisher').value.trim()) {
                        alert('Please enter the publisher for a standard citation.');
                        return false;
                    }
                }
                
                return true;
            }

            // Citation generators
            function generateWebsiteCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const websiteName = document.getElementById('website-name').value.trim();
                const url = document.getElementById('url').value.trim();
                const year = document.getElementById('year').value.trim();
                
                let accessDate = '';
                const accessDateInput = document.getElementById('access-date').value;
                if (accessDateInput) {
                    const date = new Date(accessDateInput);
                    accessDate = `Accessed: ${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}.`;
                }
                
                let citation = `${authors}, "${title}," `;
                if (websiteName) citation += `<em>${websiteName}</em>, `;
                citation += year;
                if (accessDate) citation += `. ${accessDate} `;
                citation += `[Online]. Available: ${url}`;
                
                return citation;
            }

            function generateBookCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const publisher = document.getElementById('publisher').value.trim();
                const year = document.getElementById('year').value.trim();
                const edition = document.getElementById('edition').value.trim();
                const isbn = document.getElementById('isbn').value.trim();
                
                let citation = `${authors}, <em>${title}</em>`;
                if (edition) citation += `, ${edition}`;
                citation += `. ${publisher}, ${year}`;
                if (isbn) citation += `, ISBN: ${isbn}`;
                
                return citation;
            }

            function generateJournalCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const journalName = document.getElementById('journal-name').value.trim();
                const volume = document.getElementById('volume').value.trim();
                const issue = document.getElementById('issue').value.trim();
                const pageRange = document.getElementById('page-range').value.trim();
                const year = document.getElementById('year').value.trim();
                const doi = document.getElementById('doi').value.trim();
                
                let citation = `${authors}, "${title}," <em>${journalName}</em>`;
                if (volume) citation += `, vol. ${volume}`;
                if (issue) citation += `, no. ${issue}`;
                citation += `, pp. ${pageRange}, ${year}`;
                if (doi) citation += `, doi: ${doi}`;
                
                return citation;
            }

            function generateConferenceCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const conferenceName = document.getElementById('conference-name').value.trim();
                const conferenceLocation = document.getElementById('conference-location').value.trim();
                const conferenceDate = document.getElementById('conference-date').value.trim();
                const pageRange = document.getElementById('conference-page-range').value.trim();
                const year = document.getElementById('year').value.trim();
                const doi = document.getElementById('conference-doi').value.trim();
                
                let citation = `${authors}, "${title}," in <em>${conferenceName}</em>`;
                if (conferenceLocation || conferenceDate) {
                    citation += `, ${conferenceLocation}`;
                    if (conferenceLocation && conferenceDate) citation += ', ';
                    citation += conferenceDate;
                }
                if (pageRange) citation += `, pp. ${pageRange}`;
                citation += `, ${year}`;
                if (doi) citation += `, doi: ${doi}`;
                else citation += '.';
                
                return citation;
            }

            function generateThesisCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const thesisType = document.getElementById('thesis-type').value;
                const institution = document.getElementById('institution').value.trim();
                const year = document.getElementById('year').value.trim();
                const location = document.getElementById('thesis-location').value.trim();
                
                let citation = `${authors}, "${title}," ${thesisType}, ${institution}`;
                if (location) citation += `, ${location}`;
                citation += `, ${year}.`;
                
                return citation;
            }

            function generateReportCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const reportNumber = document.getElementById('report-number').value.trim();
                const institution = document.getElementById('report-institution').value.trim();
                const year = document.getElementById('year').value.trim();
                const location = document.getElementById('report-location').value.trim();
                
                let citation = `${authors}, "${title}," `;
                if (reportNumber) citation += `${reportNumber}, `;
                citation += institution;
                if (location) citation += `, ${location}`;
                citation += `, ${year}.`;
                
                return citation;
            }

            function generatePatentCitation() {
                const authors = formatAuthors();
                const title = document.getElementById('title').value.trim();
                const patentNumber = document.getElementById('patent-number').value.trim();
                const patentDate = document.getElementById('patent-date').value.trim();
                const assignee = document.getElementById('assignee').value.trim();
                const year = document.getElementById('year').value.trim();
                
                let citation = `${authors}, "${title}," `;
                if (assignee) citation += `Assignee: ${assignee}, `;
                citation += `${patentNumber}, ${patentDate}.`;
                
                return citation;
            }

            function generateStandardCitation() {
                const authors = formatAuthors(true); // Sometimes standards have organizations as authors
                const standardNumber = document.getElementById('standard-number').value.trim();
                const standardTitle = document.getElementById('standard-title').value.trim();
                const publisher = document.getElementById('standard-publisher').value.trim();
                const standardDate = document.getElementById('standard-date').value.trim();
                const year = document.getElementById('year').value.trim();
                
                let citation = `${standardNumber}, "${standardTitle}," `;
                if (authors) citation += `${authors}, `;
                citation += publisher;
                if (standardDate) citation += `, ${standardDate}`;
                else citation += `, ${year}`;
                
                return citation;
            }

            function formatAuthors(forStandard = false) {
                const authorInputs = document.querySelectorAll('.author-name');
                const authors = Array.from(authorInputs)
                    .map(input => input.value.trim())
                    .filter(name => name);
                
                if (authors.length === 0) return '';
                
                if (forStandard && authors.length > 3) {
                    return authors[0] + ' et al.';
                }
                
                if (authors.length > 6) {
                    return authors.slice(0, 6).join(', ') + ' et al.';
                }
                
                return authors.join(', ');
            }

            // Automatic data fetching functions
            document.getElementById('fetch-website').addEventListener('click', fetchWebsiteData);
            document.getElementById('fetch-journal').addEventListener('click', fetchJournalData);
            document.getElementById('fetch-conference').addEventListener('click', fetchConferenceData);
            document.getElementById('fetch-book').addEventListener('click', fetchBookData);

            async function fetchWebsiteData() {
                const url = document.getElementById('url').value.trim();
                const statusElement = document.getElementById('website-status');
                
                if (!url) {
                    showStatus(statusElement, 'Please enter a URL first', 'error');
                    return;
                }
                
                showStatus(statusElement, 'Fetching data...', 'loading');
                
                try {
                    // First try with the Wayback Machine API
                    const waybackUrl = `https://archive.org/wayback/available?url=${encodeURIComponent(url)}`;
                    const waybackResponse = await fetch(waybackUrl);
                    const waybackData = await waybackResponse.json();
                    
                    if (waybackData.archived_snapshots && waybackData.archived_snapshots.closest) {
                        const snapshotUrl = waybackData.archived_snapshots.closest.url;
                        const response = await fetch(`https://api.microlink.io?url=${encodeURIComponent(snapshotUrl)}`);
                        const data = await response.json();
                        
                        if (data.data) {
                            updateWebsiteFields(data.data);
                            showStatus(statusElement, 'Data fetched successfully!', 'success');
                            return;
                        }
                    }
                    
                    // Fallback to direct URL
                    const response = await fetch(`https://api.microlink.io?url=${encodeURIComponent(url)}`);
                    const data = await response.json();
                    
                    if (data.data) {
                        updateWebsiteFields(data.data);
                        showStatus(statusElement, 'Data fetched successfully!', 'success');
                    } else {
                        showStatus(statusElement, 'Could not fetch data. Please enter manually.', 'error');
                    }
                } catch (error) {
                    console.error('Error fetching website data:', error);
                    showStatus(statusElement, 'Error fetching data. Please enter manually.', 'error');
                }
            }

            function updateWebsiteFields(data) {
                if (data.title) document.getElementById('title').value = data.title;
                if (data.publisher) document.getElementById('website-name').value = data.publisher;
                if (data.author) {
                    // Clear existing authors
                    const authorsList = document.getElementById('authors-list');
                    while (authorsList.children.length > 1) {
                        authorsList.removeChild(authorsList.lastChild);
                    }
                    
                    // Set the first author
                    const firstAuthor = formatAuthorName(data.author);
                    document.querySelector('.author-name').value = firstAuthor;
                    
                    // Add additional authors if available
                    if (Array.isArray(data.author)) {
                        data.author.slice(1).forEach(author => {
                            const authorDiv = document.createElement('div');
                            authorDiv.className = 'author-input';
                            authorDiv.innerHTML = `
                                <input type="text" class="author-name" placeholder="Last name, First name" value="${formatAuthorName(author)}" required>
                                <button type="button" class="remove-author-btn">Ã—</button>
                            `;
                            authorsList.appendChild(authorDiv);
                        });
                    }
                }
                if (data.date) {
                    const date = new Date(data.date);
                    if (!isNaN(date.getTime())) {
                        document.getElementById('year').value = date.getFullYear();
                    }
                }
            }

            async function fetchJournalData() {
                const doi = document.getElementById('doi').value.trim();
                const statusElement = document.getElementById('journal-status');
                
                if (!doi) {
                    showStatus(statusElement, 'Please enter a DOI first', 'error');
                    return;
                }
                
                showStatus(statusElement, 'Fetching data...', 'loading');
                
                try {
                    const response = await fetch(`https://doi.org/${encodeURIComponent(doi)}`, {
                        headers: {
                            'Accept': 'application/vnd.citationstyles.csl+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('DOI not found');
                    }
                    
                    const data = await response.json();
                    updateJournalFields(data);
                    showStatus(statusElement, 'Data fetched successfully!', 'success');
                } catch (error) {
                    console.error('Error fetching journal data:', error);
                    showStatus(statusElement, 'Error fetching data. Please enter manually.', 'error');
                }
            }

            function updateJournalFields(data) {
                if (data.title) document.getElementById('title').value = data.title;
                if (data.container-title) document.getElementById('journal-name').value = data.container-title;
                if (data.volume) document.getElementById('volume').value = data.volume;
                if (data.issue) document.getElementById('issue').value = data.issue;
                if (data.page) document.getElementById('page-range').value = data.page;
                if (data.issued && data.issued['date-parts'] && data.issued['date-parts'][0]) {
                    document.getElementById('year').value = data.issued['date-parts'][0][0];
                }
                
                if (data.author) {
                    // Clear existing authors
                    const authorsList = document.getElementById('authors-list');
                    while (authorsList.children.length > 1) {
                        authorsList.removeChild(authorsList.lastChild);
                    }
                    
                    // Set the first author
                    const firstAuthor = formatAuthorName(data.author[0]);
                    document.querySelector('.author-name').value = firstAuthor;
                    
                    // Add additional authors if available
                    data.author.slice(1).forEach(author => {
                        const authorDiv = document.createElement('div');
                        authorDiv.className = 'author-input';
                        authorDiv.innerHTML = `
                            <input type="text" class="author-name" placeholder="Last name, First name" value="${formatAuthorName(author)}" required>
                            <button type="button" class="remove-author-btn">Ã—</button>
                        `;
                        authorsList.appendChild(authorDiv);
                    });
                }
            }

            async function fetchConferenceData() {
                const doi = document.getElementById('conference-doi').value.trim();
                const statusElement = document.getElementById('conference-status');
                
                if (!doi) {
                    showStatus(statusElement, 'Please enter a DOI first', 'error');
                    return;
                }
                
                showStatus(statusElement, 'Fetching data...', 'loading');
                
                try {
                    const response = await fetch(`https://doi.org/${encodeURIComponent(doi)}`, {
                        headers: {
                            'Accept': 'application/vnd.citationstyles.csl+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('DOI not found');
                    }
                    
                    const data = await response.json();
                    updateConferenceFields(data);
                    showStatus(statusElement, 'Data fetched successfully!', 'success');
                } catch (error) {
                    console.error('Error fetching conference data:', error);
                    showStatus(statusElement, 'Error fetching data. Please enter manually.', 'error');
                }
            }

            function updateConferenceFields(data) {
                if (data.title) document.getElementById('title').value = data.title;
                if (data['event-title']) document.getElementById('conference-name').value = data['event-title'];
                if (data.issued && data.issued['date-parts'] && data.issued['date-parts'][0]) {
                    document.getElementById('year').value = data.issued['date-parts'][0][0];
                }
                if (data.page) document.getElementById('conference-page-range').value = data.page;
                
                if (data.author) {
                    // Clear existing authors
                    const authorsList = document.getElementById('authors-list');
                    while (authorsList.children.length > 1) {
                        authorsList.removeChild(authorsList.lastChild);
                    }
                    
                    // Set the first author
                    const firstAuthor = formatAuthorName(data.author[0]);
                    document.querySelector('.author-name').value = firstAuthor;
                    
                    // Add additional authors if available
                    data.author.slice(1).forEach(author => {
                        const authorDiv = document.createElement('div');
                        authorDiv.className = 'author-input';
                        authorDiv.innerHTML = `
                            <input type="text" class="author-name" placeholder="Last name, First name" value="${formatAuthorName(author)}" required>
                            <button type="button" class="remove-author-btn">Ã—</button>
                        `;
                        authorsList.appendChild(authorDiv);
                    });
                }
            }

            async function fetchBookData() {
                const isbn = document.getElementById('isbn').value.trim();
                const statusElement = document.getElementById('book-status');
                
                if (!isbn) {
                    showStatus(statusElement, 'Please enter an ISBN first', 'error');
                    return;
                }
                
                showStatus(statusElement, 'Fetching data...', 'loading');
                
                try {
                    // First try Open Library API
                    const openLibraryResponse = await fetch(`https://openlibrary.org/isbn/${isbn}.json`);
                    if (openLibraryResponse.ok) {
                        const olData = await openLibraryResponse.json();
                        const authors = await fetchBookAuthors(olData.authors);
                        
                        updateBookFields({
                            title: olData.title,
                            authors: authors,
                            publishers: olData.publishers,
                            publish_date: olData.publish_date
                        });
                        
                        showStatus(statusElement, 'Data fetched successfully!', 'success');
                        return;
                    }
                    
                    // Fallback to Google Books API
                    const googleResponse = await fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${isbn}`);
                    const googleData = await googleResponse.json();
                    
                    if (googleData.items && googleData.items.length > 0) {
                        const bookInfo = googleData.items[0].volumeInfo;
                        updateBookFields({
                            title: bookInfo.title,
                            authors: bookInfo.authors,
                            publishers: bookInfo.publisher,
                            publish_date: bookInfo.publishedDate,
                            edition: bookInfo.edition
                        });
                        showStatus(statusElement, 'Data fetched successfully!', 'success');
                    } else {
                        showStatus(statusElement, 'Could not fetch data. Please enter manually.', 'error');
                    }
                } catch (error) {
                    console.error('Error fetching book data:', error);
                    showStatus(statusElement, 'Error fetching data. Please enter manually.', 'error');
                }
            }

            async function fetchBookAuthors(authorLinks) {
                if (!authorLinks || !Array.isArray(authorLinks)) return [];
                
                const authors = [];
                for (const link of authorLinks) {
                    try {
                        const response = await fetch(`https://openlibrary.org${link.key}.json`);
                        const data = await response.json();
                        if (data.name) {
                            authors.push(data.name);
                        }
                    } catch (error) {
                        console.error('Error fetching author:', error);
                    }
                }
                return authors;
            }

            function updateBookFields(data) {
                if (data.title) document.getElementById('title').value = data.title;
                if (data.publishers) document.getElementById('publisher').value = data.publishers.join(', ');
                if (data.publish_date) {
                    const yearMatch = data.publish_date.match(/\d{4}/);
                    if (yearMatch) {
                        document.getElementById('year').value = yearMatch[0];
                    }
                }
                if (data.edition) document.getElementById('edition').value = data.edition;
                
                if (data.authors) {
                    // Clear existing authors
                    const authorsList = document.getElementById('authors-list');
                    while (authorsList.children.length > 1) {
                        authorsList.removeChild(authorsList.lastChild);
                    }
                    
                    // Set the first author
                    const firstAuthor = formatAuthorName(data.authors[0]);
                    document.querySelector('.author-name').value = firstAuthor;
                    
                    // Add additional authors if available
                    data.authors.slice(1).forEach(author => {
                        const authorDiv = document.createElement('div');
                        authorDiv.className = 'author-input';
                        authorDiv.innerHTML = `
                            <input type="text" class="author-name" placeholder="Last name, First name" value="${formatAuthorName(author)}" required>
                            <button type="button" class="remove-author-btn">Ã—</button>
                        `;
                        authorsList.appendChild(authorDiv);
                    });
                }
            }

            function formatAuthorName(author) {
                if (!author) return '';
                
                // Handle CSL-JSON format
                if (typeof author === 'object' && author.family && author.given) {
                    return `${author.family}, ${author.given}`;
                }
                
                // Handle string names
                if (typeof author === 'string') {
                    const parts = author.split(' ');
                    if (parts.length > 1) {
                        return `${parts[parts.length - 1]}, ${parts.slice(0, -1).join(' ')}`;
                    }
                    return author;
                }
                
                return '';
            }

            function showStatus(element, message, type) {
                element.innerHTML = '';
                
                if (type === 'loading') {
                    const spinner = document.createElement('span');
                    spinner.className = 'loading';
                    element.appendChild(spinner);
                }
                
                const text = document.createElement('span');
                text.textContent = message;
                text.className = type;
                element.appendChild(text);
                
                // Clear status after 5 seconds
                if (type !== 'loading') {
                    setTimeout(() => {
                        element.innerHTML = '';
                    }, 5000);
                }
            }
        });
    </script>
</body>
</html>
